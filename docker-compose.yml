services:
  openclaw-gateway:
    build:
      context: ./volume_openclaw
      args:
        UV_IMAGE_TAG: ${UV_IMAGE_TAG:-python3.14-bookworm-slim}
    expose:
      - "18789"
    # ports:
    #   - "18789:18789"
    environment:
      HOME: /home/node
      TERM: xterm-256color
      OPENCLAW_GATEWAY_TOKEN: ${OPENCLAW_GATEWAY_TOKEN:?Please set OPENCLAW_GATEWAY_TOKEN}
      OPENCLAW_OVERRIDE_CONFIG: ${OPENCLAW_OVERRIDE_CONFIG:-false}
      OPENCLAW_REQUIRE_CONTROL_UI_PAIRING: ${OPENCLAW_REQUIRE_CONTROL_UI_PAIRING:-true}
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      OPENAI_API_BASE: ${OPENAI_API_BASE:-}
      DEFAULT_MODEL_PROVIDER: ${DEFAULT_MODEL_PROVIDER:-openai}
      OPENAI_DEFAULT_MODEL: ${OPENAI_DEFAULT_MODEL:-openai/gpt-4o}
      GEMINI_API_KEY: ${GEMINI_API_KEY}
      BROWSERLESS_BASE_URL: ${BROWSERLESS_BASE_URL}
      BROWSERLESS_TOKEN: ${BROWSERLESS_TOKEN}
    volumes:
      - openclaw_config:/home/node/.openclaw
      - /var/run/docker.sock:/var/run/docker.sock
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:18789/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  openclaw_config:
